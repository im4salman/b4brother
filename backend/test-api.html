<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B4 Brothers Backend API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            text-align: center;
            padding: 40px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .card h3 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            border-bottom: 2px solid #f59e0b;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .btn:hover {
            background: #d97706;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        .response.success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #064e3b;
        }

        .response.error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #7f1d1d;
        }

        .response.info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e3a8a;
        }

        .token-display {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #d1d5db;
        }

        .token-display strong {
            color: #374151;
        }

        .endpoint-url {
            background: #f8fafc;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
            color: #1e293b;
        }

        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 12px;
            margin-right: 10px;
        }

        .method.get { background: #10b981; color: white; }
        .method.post { background: #3b82f6; color: white; }
        .method.put { background: #f59e0b; color: white; }
        .method.delete { background: #ef4444; color: white; }

        .description {
            background: #f8fafc;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #f59e0b;
            font-size: 14px;
            color: #4b5563;
        }

        .admin-section {
            border: 2px solid #ef4444;
            background: #fef2f2;
        }

        .admin-section h3 {
            color: #dc2626;
            border-bottom-color: #ef4444;
        }

        .tables-overview {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }

        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .table-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }

        .table-card h4 {
            color: #1e293b;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .table-card p {
            color: #4b5563;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è B4 Brothers Backend API Tester</h1>
            <p>Test all API endpoints for the construction management system</p>
            <p><strong>Base URL:</strong> http://localhost:5000/api</p>
        </div>

        <div class="status" id="serverStatus">
            üîÑ Checking server status...
        </div>

        <!-- Database Tables Overview -->
        <div class="tables-overview">
            <h2>üìä Database Tables Structure</h2>
            <div class="tables-grid">
                <div class="table-card">
                    <h4>üë§ users</h4>
                    <p>Admin user management and authentication with JWT tokens</p>
                </div>
                <div class="table-card">
                    <h4>üìà analytics</h4>
                    <p>Website visitor tracking, page views, clicks, form submissions</p>
                </div>
                <div class="table-card">
                    <h4>üìã form_submissions</h4>
                    <p>Contact forms, career applications, quote requests from website</p>
                </div>
                <div class="table-card">
                    <h4>üìù submission_notes</h4>
                    <p>Admin notes and comments on form submissions</p>
                </div>
                <div class="table-card">
                    <h4>‚≠ê testimonials</h4>
                    <p>Client testimonials, reviews, and ratings</p>
                </div>
                <div class="table-card">
                    <h4>üèóÔ∏è projects</h4>
                    <p>Portfolio projects with images, details, and client information</p>
                </div>
                <div class="table-card">
                    <h4>üì∞ news</h4>
                    <p>Blog posts, company news, and updates</p>
                </div>
                <div class="table-card">
                    <h4>‚öôÔ∏è configs</h4>
                    <p>Site configuration, settings, and dynamic content</p>
                </div>
                <div class="table-card">
                    <h4>üìû contact_info</h4>
                    <p>Contact information, phone numbers, emails, addresses</p>
                </div>
                <div class="table-card">
                    <h4>üîß services</h4>
                    <p>Service offerings, descriptions, and pricing information</p>
                </div>
            </div>
        </div>

        <!-- Authentication Section -->
        <div class="token-display">
            <strong>Authentication Token:</strong> <span id="authToken">Not logged in</span>
            <button class="btn btn-secondary" onclick="clearToken()" style="margin-left: 15px;">Clear Token</button>
        </div>

        <div class="grid">
            <!-- Health Check -->
            <div class="card">
                <h3>üü¢ Health Check</h3>
                <div class="endpoint-url">
                    <span class="method get">GET</span>/health
                </div>
                <div class="description">
                    Check if the server and database are running properly
                </div>
                <button class="btn" onclick="testHealth()">Test Health</button>
                <div id="healthResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Admin Login -->
            <div class="card admin-section">
                <h3>üîë Admin Login</h3>
                <div class="endpoint-url">
                    <span class="method post">POST</span>/auth/login
                </div>
                <div class="description">
                    Authenticate admin user and get access token
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="loginUsername" value="admin" placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="loginPassword" value="b4brothers2024" placeholder="Enter password">
                </div>
                <button class="btn" onclick="testLogin()">Login</button>
                <div id="loginResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Submit Form -->
            <div class="card">
                <h3>üìù Submit Form</h3>
                <div class="endpoint-url">
                    <span class="method post">POST</span>/forms/submit
                </div>
                <div class="description">
                    Submit contact form, career application, or quote request
                </div>
                <div class="form-group">
                    <label>Form Type:</label>
                    <select id="formType">
                        <option value="contact">Contact Form</option>
                        <option value="career">Career Application</option>
                        <option value="quote">Quote Request</option>
                        <option value="newsletter">Newsletter</option>
                        <option value="quick_contact">Quick Contact</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="formName" value="John Doe" placeholder="Full name">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="formEmail" value="john@example.com" placeholder="Email address">
                </div>
                <div class="form-group">
                    <label>Phone:</label>
                    <input type="tel" id="formPhone" value="+91 98765 43210" placeholder="Phone number">
                </div>
                <div class="form-group">
                    <label>Message:</label>
                    <textarea id="formMessage" placeholder="Your message">Looking for construction services for my new home project.</textarea>
                </div>
                <button class="btn" onclick="testFormSubmit()">Submit Form</button>
                <div id="formResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Track Analytics -->
            <div class="card">
                <h3>üìä Track Analytics</h3>
                <div class="endpoint-url">
                    <span class="method post">POST</span>/analytics/track
                </div>
                <div class="description">
                    Track user events for analytics (page views, clicks, etc.)
                </div>
                <div class="form-group">
                    <label>Event Type:</label>
                    <select id="eventType">
                        <option value="pageview">Page View</option>
                        <option value="click">Button Click</option>
                        <option value="form_submission">Form Submission</option>
                        <option value="whatsapp_redirect">WhatsApp Redirect</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Page/Element:</label>
                    <input type="text" id="eventPage" value="/" placeholder="Page URL or element name">
                </div>
                <button class="btn" onclick="testAnalytics()">Track Event</button>
                <div id="analyticsResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Get Projects -->
            <div class="card">
                <h3>üèóÔ∏è Get Projects</h3>
                <div class="endpoint-url">
                    <span class="method get">GET</span>/projects
                </div>
                <div class="description">
                    Retrieve list of construction projects for portfolio
                </div>
                <div class="form-group">
                    <label>Category:</label>
                    <select id="projectCategory">
                        <option value="">All Categories</option>
                        <option value="Residential">Residential</option>
                        <option value="Commercial">Commercial</option>
                        <option value="Industrial">Industrial</option>
                        <option value="Renovation">Renovation</option>
                        <option value="Hospitality">Hospitality</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Limit:</label>
                    <input type="number" id="projectLimit" value="5" min="1" max="50">
                </div>
                <button class="btn" onclick="testGetProjects()">Get Projects</button>
                <div id="projectsResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Get Testimonials -->
            <div class="card">
                <h3>‚≠ê Get Testimonials</h3>
                <div class="endpoint-url">
                    <span class="method get">GET</span>/testimonials
                </div>
                <div class="description">
                    Retrieve client testimonials and reviews
                </div>
                <div class="form-group">
                    <label>Featured Only:</label>
                    <select id="featuredOnly">
                        <option value="">All Testimonials</option>
                        <option value="true">Featured Only</option>
                        <option value="false">Non-Featured</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Limit:</label>
                    <input type="number" id="testimonialLimit" value="5" min="1" max="20">
                </div>
                <button class="btn" onclick="testGetTestimonials()">Get Testimonials</button>
                <div id="testimonialsResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Get Services -->
            <div class="card">
                <h3>üîß Get Services</h3>
                <div class="endpoint-url">
                    <span class="method get">GET</span>/services
                </div>
                <div class="description">
                    Retrieve list of construction services offered
                </div>
                <button class="btn" onclick="testGetServices()">Get Services</button>
                <div id="servicesResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Get Configuration -->
            <div class="card">
                <h3>‚öôÔ∏è Get Configuration</h3>
                <div class="endpoint-url">
                    <span class="method get">GET</span>/config
                </div>
                <div class="description">
                    Retrieve site configuration and settings
                </div>
                <div class="form-group">
                    <label>Category:</label>
                    <select id="configCategory">
                        <option value="">All Configs</option>
                        <option value="general">General</option>
                        <option value="contact">Contact</option>
                        <option value="social">Social Media</option>
                        <option value="seo">SEO</option>
                    </select>
                </div>
                <button class="btn" onclick="testGetConfig()">Get Config</button>
                <div id="configResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Admin: Get Analytics Dashboard -->
            <div class="card admin-section">
                <h3>üìà Analytics Dashboard (Admin)</h3>
                <div class="endpoint-url">
                    <span class="method get">GET</span>/analytics/dashboard
                </div>
                <div class="description">
                    Get comprehensive analytics dashboard data (requires admin login)
                </div>
                <div class="form-group">
                    <label>Start Date:</label>
                    <input type="date" id="startDate">
                </div>
                <div class="form-group">
                    <label>End Date:</label>
                    <input type="date" id="endDate">
                </div>
                <button class="btn" onclick="testAnalyticsDashboard()">Get Dashboard</button>
                <div id="dashboardResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Admin: Get Form Submissions -->
            <div class="card admin-section">
                <h3>üìã Form Submissions (Admin)</h3>
                <div class="endpoint-url">
                    <span class="method get">GET</span>/forms/submissions
                </div>
                <div class="description">
                    Retrieve and manage form submissions (requires admin login)
                </div>
                <div class="form-group">
                    <label>Status Filter:</label>
                    <select id="statusFilter">
                        <option value="">All Statuses</option>
                        <option value="new">New</option>
                        <option value="contacted">Contacted</option>
                        <option value="in_progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Limit:</label>
                    <input type="number" id="submissionLimit" value="10" min="1" max="50">
                </div>
                <button class="btn" onclick="testGetSubmissions()">Get Submissions</button>
                <div id="submissionsResponse" class="response" style="display: none;"></div>
            </div>

            <!-- Admin: Create Testimonial -->
            <div class="card admin-section">
                <h3>‚ûï Create Testimonial (Admin)</h3>
                <div class="endpoint-url">
                    <span class="method post">POST</span>/testimonials
                </div>
                <div class="description">
                    Create new client testimonial (requires admin login)
                </div>
                <div class="form-group">
                    <label>Client Name:</label>
                    <input type="text" id="newTestimonialName" value="Jane Smith" placeholder="Client name">
                </div>
                <div class="form-group">
                    <label>Review:</label>
                    <textarea id="newTestimonialReview" placeholder="Client review">Excellent work by B4 Brothers! Highly professional and quality construction.</textarea>
                </div>
                <div class="form-group">
                    <label>Position:</label>
                    <input type="text" id="newTestimonialPost" value="Home Owner" placeholder="Client position">
                </div>
                <div class="form-group">
                    <label>Rating:</label>
                    <select id="newTestimonialRating">
                        <option value="5">5 Stars</option>
                        <option value="4">4 Stars</option>
                        <option value="3">3 Stars</option>
                        <option value="2">2 Stars</option>
                        <option value="1">1 Star</option>
                    </select>
                </div>
                <button class="btn" onclick="testCreateTestimonial()">Create Testimonial</button>
                <div id="createTestimonialResponse" class="response" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:5000/api';
        let authToken = localStorage.getItem('b4-admin-token');

        // Update token display
        function updateTokenDisplay() {
            const tokenDisplay = document.getElementById('authToken');
            if (authToken) {
                tokenDisplay.textContent = authToken.substring(0, 20) + '...';
                tokenDisplay.style.color = '#10b981';
            } else {
                tokenDisplay.textContent = 'Not logged in';
                tokenDisplay.style.color = '#ef4444';
            }
        }

        // Clear auth token
        function clearToken() {
            authToken = null;
            localStorage.removeItem('b4-admin-token');
            updateTokenDisplay();
        }

        // Generate visitor ID
        function generateVisitorId() {
            return 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Make API request
        async function makeRequest(endpoint, method = 'GET', data = null, requiresAuth = false) {
            const url = `${BASE_URL}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
            };

            if (requiresAuth && authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            const options = {
                method,
                headers,
            };

            if (data && (method === 'POST' || method === 'PUT')) {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(url, options);
                const result = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: result
                };
            } catch (error) {
                return {
                    success: false,
                    status: 0,
                    data: { error: error.message }
                };
            }
        }

        // Display response
        function displayResponse(elementId, response) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            if (response.success) {
                element.className = 'response success';
                element.textContent = `‚úÖ Success (${response.status})\n\n${JSON.stringify(response.data, null, 2)}`;
            } else {
                element.className = 'response error';
                element.textContent = `‚ùå Error (${response.status})\n\n${JSON.stringify(response.data, null, 2)}`;
            }
        }

        // Test functions
        async function testHealth() {
            const response = await makeRequest('/health');
            displayResponse('healthResponse', response);
            
            // Update server status
            const statusEl = document.getElementById('serverStatus');
            if (response.success) {
                statusEl.textContent = '‚úÖ Server is running and database is connected';
                statusEl.style.background = '#10b981';
            } else {
                statusEl.textContent = '‚ùå Server is not responding';
                statusEl.style.background = '#ef4444';
            }
        }

        async function testLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const response = await makeRequest('/auth/login', 'POST', {
                username,
                password
            });
            
            if (response.success && response.data.token) {
                authToken = response.data.token;
                localStorage.setItem('b4-admin-token', authToken);
                updateTokenDisplay();
            }
            
            displayResponse('loginResponse', response);
        }

        async function testFormSubmit() {
            const visitorId = generateVisitorId();
            const data = {
                type: document.getElementById('formType').value,
                formData: {
                    name: document.getElementById('formName').value,
                    email: document.getElementById('formEmail').value,
                    phone: document.getElementById('formPhone').value,
                    message: document.getElementById('formMessage').value
                },
                visitorId,
                sessionId: visitorId,
                source: 'api_test'
            };
            
            const response = await makeRequest('/forms/submit', 'POST', data);
            displayResponse('formResponse', response);
        }

        async function testAnalytics() {
            const visitorId = generateVisitorId();
            const eventType = document.getElementById('eventType').value;
            const page = document.getElementById('eventPage').value;
            
            const data = {
                visitorId,
                sessionId: visitorId,
                eventType,
                eventData: eventType === 'pageview' ? { page } : { element: page, location: '/' },
                userAgent: navigator.userAgent,
                referrer: document.referrer
            };
            
            const response = await makeRequest('/analytics/track', 'POST', data);
            displayResponse('analyticsResponse', response);
        }

        async function testGetProjects() {
            const category = document.getElementById('projectCategory').value;
            const limit = document.getElementById('projectLimit').value;
            
            let endpoint = '/projects?';
            if (category) endpoint += `category=${category}&`;
            if (limit) endpoint += `limit=${limit}`;
            
            const response = await makeRequest(endpoint);
            displayResponse('projectsResponse', response);
        }

        async function testGetTestimonials() {
            const featured = document.getElementById('featuredOnly').value;
            const limit = document.getElementById('testimonialLimit').value;
            
            let endpoint = '/testimonials?';
            if (featured) endpoint += `isFeatured=${featured}&`;
            if (limit) endpoint += `limit=${limit}`;
            
            const response = await makeRequest(endpoint);
            displayResponse('testimonialsResponse', response);
        }

        async function testGetServices() {
            const response = await makeRequest('/services');
            displayResponse('servicesResponse', response);
        }

        async function testGetConfig() {
            const category = document.getElementById('configCategory').value;
            let endpoint = '/config';
            if (category) endpoint += `?category=${category}`;
            
            const response = await makeRequest(endpoint);
            displayResponse('configResponse', response);
        }

        async function testAnalyticsDashboard() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let endpoint = '/analytics/dashboard?';
            if (startDate) endpoint += `startDate=${startDate}&`;
            if (endDate) endpoint += `endDate=${endDate}`;
            
            const response = await makeRequest(endpoint, 'GET', null, true);
            displayResponse('dashboardResponse', response);
        }

        async function testGetSubmissions() {
            const status = document.getElementById('statusFilter').value;
            const limit = document.getElementById('submissionLimit').value;
            
            let endpoint = '/forms/submissions?';
            if (status) endpoint += `status=${status}&`;
            if (limit) endpoint += `limit=${limit}`;
            
            const response = await makeRequest(endpoint, 'GET', null, true);
            displayResponse('submissionsResponse', response);
        }

        async function testCreateTestimonial() {
            const data = {
                name: document.getElementById('newTestimonialName').value,
                about: document.getElementById('newTestimonialReview').value,
                post: document.getElementById('newTestimonialPost').value,
                rating: parseInt(document.getElementById('newTestimonialRating').value),
                isActive: true,
                isFeatured: false,
                verificationStatus: 'verified'
            };
            
            const response = await makeRequest('/testimonials', 'POST', data, true);
            displayResponse('createTestimonialResponse', response);
        }

        // Initialize
        updateTokenDisplay();
        testHealth();

        // Set default dates
        const today = new Date();
        const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
        document.getElementById('startDate').value = weekAgo.toISOString().split('T')[0];
        document.getElementById('endDate').value = today.toISOString().split('T')[0];
    </script>
</body>
</html>
